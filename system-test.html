<!DOCTYPE html>
<html>
<head>
    <title>Oriental Insurance Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 2px solid #ddd; border-radius: 8px; }
        .success { border-color: #4CAF50; background: #f8fff8; }
        .error { border-color: #f44336; background: #fff8f8; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .result { margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 4px; }
        input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>ğŸ¢ Oriental Insurance System Test</h1>
    
    <div class="test-section">
        <h2>ğŸ” Policy Verification Test</h2>
        <p>Test with working policy numbers:</p>
        <button onclick="testPolicy('HLT/2025/5324')">Test HLT/2025/5324</button>
        <button onclick="testPolicy('HLT/2025/6265')">Test HLT/2025/6265</button>
        <div id="policyResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“‹ Claims Display Test</h2>
        <p>Test claims retrieval:</p>
        <button onclick="testClaims()">Get All Claims</button>
        <button onclick="testClaimsForPolicy('HLT/2025/5324')">Claims for HLT/2025/5324</button>
        <button onclick="testClaimsForPolicy('HLT/2025/6265')">Claims for HLT/2025/6265</button>
        <div id="claimsResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸŒ Full Integration Test</h2>
        <p>Test the complete workflow:</p>
        <input type="text" id="testPolicyInput" placeholder="Enter policy number (e.g., HLT/2025/5324)" value="HLT/2025/5324">
        <button onclick="testFullWorkflow()">Test Complete Workflow</button>
        <div id="workflowResult" class="result"></div>
    </div>

    <script>
        function testPolicy(policyNumber) {
            const resultDiv = document.getElementById('policyResult');
            resultDiv.innerHTML = `ğŸ”„ Testing policy ${policyNumber}...`;
            
            fetch(`http://localhost:5000/api/policies/number/${encodeURIComponent(policyNumber)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        resultDiv.innerHTML = `
                            <div style="color: green;">
                                âœ… <strong>Policy Verification SUCCESS</strong><br>
                                ğŸ“‹ Policy: ${data.data.policyNumber}<br>
                                ğŸ‘¤ Customer: ${data.data.customerName}<br>
                                ğŸ“§ Email: ${data.data.email}<br>
                                ğŸ’° Coverage: â‚¹${data.data.coverageAmount?.toLocaleString()}<br>
                                ğŸ“± Phone: ${data.data.phone}<br>
                                âœ¨ Status: ${data.data.status}
                            </div>
                        `;
                    } else {
                        resultDiv.innerHTML = `<div style="color: red;">âŒ Policy verification failed: ${data.message}</div>`;
                    }
                })
                .catch(error => {
                    resultDiv.innerHTML = `<div style="color: red;">âŒ Error: ${error.message}</div>`;
                });
        }
        
        function testClaims() {
            const resultDiv = document.getElementById('claimsResult');
            resultDiv.innerHTML = 'ğŸ”„ Loading claims...';
            
            fetch('http://localhost:5000/api/claims')
                .then(response => response.json())
                .then(data => {
                    if (data && Array.isArray(data)) {
                        const claimsHtml = data.map(claim => `
                            <div style="border: 1px solid #ccc; margin: 5px 0; padding: 10px; border-radius: 4px;">
                                ğŸ“‹ <strong>${claim.id}</strong> - Policy: ${claim.policyNumber}<br>
                                ğŸ¥ Type: ${claim.type}<br>
                                ğŸ’° Amount: â‚¹${claim.estimatedAmount?.toLocaleString()}<br>
                                ğŸ“… Date: ${claim.incidentDate}<br>
                                âš¡ Status: ${claim.status}
                            </div>
                        `).join('');
                        
                        resultDiv.innerHTML = `
                            <div style="color: green;">
                                âœ… <strong>Claims Retrieval SUCCESS</strong><br>
                                ğŸ“Š Found ${data.length} claims:<br>
                                ${claimsHtml}
                            </div>
                        `;
                    } else {
                        resultDiv.innerHTML = `<div style="color: orange;">âš ï¸ No claims found or unexpected response format</div>`;
                    }
                })
                .catch(error => {
                    resultDiv.innerHTML = `<div style="color: red;">âŒ Error: ${error.message}</div>`;
                });
        }
        
        function testClaimsForPolicy(policyNumber) {
            const resultDiv = document.getElementById('claimsResult');
            resultDiv.innerHTML = `ğŸ”„ Loading claims for ${policyNumber}...`;
            
            fetch('http://localhost:5000/api/claims')
                .then(response => response.json())
                .then(data => {
                    if (data && Array.isArray(data)) {
                        const policyClaims = data.filter(claim => claim.policyNumber === policyNumber);
                        
                        if (policyClaims.length > 0) {
                            const claimsHtml = policyClaims.map(claim => `
                                <div style="border: 1px solid #ccc; margin: 5px 0; padding: 10px; border-radius: 4px;">
                                    ğŸ“‹ <strong>${claim.id}</strong><br>
                                    ğŸ¥ Type: ${claim.type}<br>
                                    ğŸ’° Amount: â‚¹${claim.estimatedAmount?.toLocaleString()}<br>
                                    ğŸ“… Date: ${claim.incidentDate}<br>
                                    âš¡ Status: ${claim.status}<br>
                                    ğŸ¥ Hospital: ${claim.hospitalName || 'N/A'}
                                </div>
                            `).join('');
                            
                            resultDiv.innerHTML = `
                                <div style="color: green;">
                                    âœ… <strong>Policy Claims SUCCESS</strong><br>
                                    ğŸ“Š Found ${policyClaims.length} claims for ${policyNumber}:<br>
                                    ${claimsHtml}
                                </div>
                            `;
                        } else {
                            resultDiv.innerHTML = `<div style="color: orange;">âš ï¸ No claims found for policy ${policyNumber}</div>`;
                        }
                    } else {
                        resultDiv.innerHTML = `<div style="color: red;">âŒ Failed to retrieve claims data</div>`;
                    }
                })
                .catch(error => {
                    resultDiv.innerHTML = `<div style="color: red;">âŒ Error: ${error.message}</div>`;
                });
        }
        
        function testFullWorkflow() {
            const policyNumber = document.getElementById('testPolicyInput').value.trim();
            const resultDiv = document.getElementById('workflowResult');
            
            if (!policyNumber) {
                resultDiv.innerHTML = '<div style="color: red;">âŒ Please enter a policy number</div>';
                return;
            }
            
            resultDiv.innerHTML = `ğŸ”„ Testing complete workflow for ${policyNumber}...`;
            
            // Step 1: Verify policy
            fetch(`http://localhost:5000/api/policies/number/${encodeURIComponent(policyNumber)}`)
                .then(response => response.json())
                .then(policyData => {
                    if (policyData.success) {
                        // Step 2: Get claims for this policy
                        return fetch('http://localhost:5000/api/claims')
                            .then(response => response.json())
                            .then(claimsData => {
                                const policyClaims = Array.isArray(claimsData) ? 
                                    claimsData.filter(claim => claim.policyNumber === policyNumber) : [];
                                
                                const pendingClaims = policyClaims.filter(claim => 
                                    claim.status !== 'Approved' && 
                                    claim.status !== 'Paid' && 
                                    claim.status !== 'Closed'
                                );
                                
                                let claimsHtml = '';
                                if (pendingClaims.length > 0) {
                                    claimsHtml = `
                                        <div style="margin: 10px 0; padding: 10px; background: #fff3cd; border-radius: 4px;">
                                            ğŸ“‹ <strong>Pending Claims Found:</strong><br>
                                            ${pendingClaims.map(claim => `
                                                â€¢ ${claim.id}: ${claim.type} - â‚¹${claim.estimatedAmount?.toLocaleString()} (${claim.status})
                                            `).join('<br>')}
                                        </div>
                                    `;
                                } else {
                                    claimsHtml = '<div style="margin: 10px 0; padding: 10px; background: #d4edda; border-radius: 4px;">âœ… No pending claims found</div>';
                                }
                                
                                resultDiv.innerHTML = `
                                    <div style="color: green;">
                                        âœ… <strong>COMPLETE WORKFLOW SUCCESS</strong><br><br>
                                        
                                        <div style="margin: 10px 0; padding: 10px; background: #d1ecf1; border-radius: 4px;">
                                            ğŸ” <strong>Policy Verification:</strong><br>
                                            ğŸ“‹ Policy: ${policyData.data.policyNumber}<br>
                                            ğŸ‘¤ Customer: ${policyData.data.customerName}<br>
                                            ğŸ’° Coverage: â‚¹${policyData.data.coverageAmount?.toLocaleString()}<br>
                                            âœ¨ Status: ${policyData.data.status}
                                        </div>
                                        
                                        ${claimsHtml}
                                        
                                        <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                                            ğŸ¯ <strong>Result:</strong> Both policy verification and claims display are working correctly!
                                        </div>
                                    </div>
                                `;
                            });
                    } else {
                        resultDiv.innerHTML = `<div style="color: red;">âŒ Policy verification failed: ${policyData.message}</div>`;
                    }
                })
                .catch(error => {
                    resultDiv.innerHTML = `<div style="color: red;">âŒ Workflow failed: ${error.message}</div>`;
                });
        }
        
        // Auto-run basic tests on page load
        window.addEventListener('load', function() {
            setTimeout(() => {
                testPolicy('HLT/2025/5324');
                setTimeout(() => testClaims(), 1000);
            }, 500);
        });
    </script>
</body>
</html>
