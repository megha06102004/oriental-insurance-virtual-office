<!DOCTYPE html>
<html>
<head>
    <title>Oriental Insurance Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 2px solid #ddd; border-radius: 8px; }
        .success { border-color: #4CAF50; background: #f8fff8; }
        .error { border-color: #f44336; background: #fff8f8; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .result { margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 4px; }
        input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>🏢 Oriental Insurance System Test</h1>
    
    <div class="test-section">
        <h2>🔍 Policy Verification Test</h2>
        <p>Test with working policy numbers:</p>
        <button onclick="testPolicy('HLT/2025/5324')">Test HLT/2025/5324</button>
        <button onclick="testPolicy('HLT/2025/6265')">Test HLT/2025/6265</button>
        <div id="policyResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>📋 Claims Display Test</h2>
        <p>Test claims retrieval:</p>
        <button onclick="testClaims()">Get All Claims</button>
        <button onclick="testClaimsForPolicy('HLT/2025/5324')">Claims for HLT/2025/5324</button>
        <button onclick="testClaimsForPolicy('HLT/2025/6265')">Claims for HLT/2025/6265</button>
        <div id="claimsResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>🌐 Full Integration Test</h2>
        <p>Test the complete workflow:</p>
        <input type="text" id="testPolicyInput" placeholder="Enter policy number (e.g., HLT/2025/5324)" value="HLT/2025/5324">
        <button onclick="testFullWorkflow()">Test Complete Workflow</button>
        <div id="workflowResult" class="result"></div>
    </div>

    <script>
        function testPolicy(policyNumber) {
            const resultDiv = document.getElementById('policyResult');
            resultDiv.innerHTML = `🔄 Testing policy ${policyNumber}...`;
            
            fetch(`http://localhost:5000/api/policies/number/${encodeURIComponent(policyNumber)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        resultDiv.innerHTML = `
                            <div style="color: green;">
                                ✅ <strong>Policy Verification SUCCESS</strong><br>
                                📋 Policy: ${data.data.policyNumber}<br>
                                👤 Customer: ${data.data.customerName}<br>
                                📧 Email: ${data.data.email}<br>
                                💰 Coverage: ₹${data.data.coverageAmount?.toLocaleString()}<br>
                                📱 Phone: ${data.data.phone}<br>
                                ✨ Status: ${data.data.status}
                            </div>
                        `;
                    } else {
                        resultDiv.innerHTML = `<div style="color: red;">❌ Policy verification failed: ${data.message}</div>`;
                    }
                })
                .catch(error => {
                    resultDiv.innerHTML = `<div style="color: red;">❌ Error: ${error.message}</div>`;
                });
        }
        
        function testClaims() {
            const resultDiv = document.getElementById('claimsResult');
            resultDiv.innerHTML = '🔄 Loading claims...';
            
            fetch('http://localhost:5000/api/claims')
                .then(response => response.json())
                .then(data => {
                    if (data && Array.isArray(data)) {
                        const claimsHtml = data.map(claim => `
                            <div style="border: 1px solid #ccc; margin: 5px 0; padding: 10px; border-radius: 4px;">
                                📋 <strong>${claim.id}</strong> - Policy: ${claim.policyNumber}<br>
                                🏥 Type: ${claim.type}<br>
                                💰 Amount: ₹${claim.estimatedAmount?.toLocaleString()}<br>
                                📅 Date: ${claim.incidentDate}<br>
                                ⚡ Status: ${claim.status}
                            </div>
                        `).join('');
                        
                        resultDiv.innerHTML = `
                            <div style="color: green;">
                                ✅ <strong>Claims Retrieval SUCCESS</strong><br>
                                📊 Found ${data.length} claims:<br>
                                ${claimsHtml}
                            </div>
                        `;
                    } else {
                        resultDiv.innerHTML = `<div style="color: orange;">⚠️ No claims found or unexpected response format</div>`;
                    }
                })
                .catch(error => {
                    resultDiv.innerHTML = `<div style="color: red;">❌ Error: ${error.message}</div>`;
                });
        }
        
        function testClaimsForPolicy(policyNumber) {
            const resultDiv = document.getElementById('claimsResult');
            resultDiv.innerHTML = `🔄 Loading claims for ${policyNumber}...`;
            
            fetch('http://localhost:5000/api/claims')
                .then(response => response.json())
                .then(data => {
                    if (data && Array.isArray(data)) {
                        const policyClaims = data.filter(claim => claim.policyNumber === policyNumber);
                        
                        if (policyClaims.length > 0) {
                            const claimsHtml = policyClaims.map(claim => `
                                <div style="border: 1px solid #ccc; margin: 5px 0; padding: 10px; border-radius: 4px;">
                                    📋 <strong>${claim.id}</strong><br>
                                    🏥 Type: ${claim.type}<br>
                                    💰 Amount: ₹${claim.estimatedAmount?.toLocaleString()}<br>
                                    📅 Date: ${claim.incidentDate}<br>
                                    ⚡ Status: ${claim.status}<br>
                                    🏥 Hospital: ${claim.hospitalName || 'N/A'}
                                </div>
                            `).join('');
                            
                            resultDiv.innerHTML = `
                                <div style="color: green;">
                                    ✅ <strong>Policy Claims SUCCESS</strong><br>
                                    📊 Found ${policyClaims.length} claims for ${policyNumber}:<br>
                                    ${claimsHtml}
                                </div>
                            `;
                        } else {
                            resultDiv.innerHTML = `<div style="color: orange;">⚠️ No claims found for policy ${policyNumber}</div>`;
                        }
                    } else {
                        resultDiv.innerHTML = `<div style="color: red;">❌ Failed to retrieve claims data</div>`;
                    }
                })
                .catch(error => {
                    resultDiv.innerHTML = `<div style="color: red;">❌ Error: ${error.message}</div>`;
                });
        }
        
        function testFullWorkflow() {
            const policyNumber = document.getElementById('testPolicyInput').value.trim();
            const resultDiv = document.getElementById('workflowResult');
            
            if (!policyNumber) {
                resultDiv.innerHTML = '<div style="color: red;">❌ Please enter a policy number</div>';
                return;
            }
            
            resultDiv.innerHTML = `🔄 Testing complete workflow for ${policyNumber}...`;
            
            // Step 1: Verify policy
            fetch(`http://localhost:5000/api/policies/number/${encodeURIComponent(policyNumber)}`)
                .then(response => response.json())
                .then(policyData => {
                    if (policyData.success) {
                        // Step 2: Get claims for this policy
                        return fetch('http://localhost:5000/api/claims')
                            .then(response => response.json())
                            .then(claimsData => {
                                const policyClaims = Array.isArray(claimsData) ? 
                                    claimsData.filter(claim => claim.policyNumber === policyNumber) : [];
                                
                                const pendingClaims = policyClaims.filter(claim => 
                                    claim.status !== 'Approved' && 
                                    claim.status !== 'Paid' && 
                                    claim.status !== 'Closed'
                                );
                                
                                let claimsHtml = '';
                                if (pendingClaims.length > 0) {
                                    claimsHtml = `
                                        <div style="margin: 10px 0; padding: 10px; background: #fff3cd; border-radius: 4px;">
                                            📋 <strong>Pending Claims Found:</strong><br>
                                            ${pendingClaims.map(claim => `
                                                • ${claim.id}: ${claim.type} - ₹${claim.estimatedAmount?.toLocaleString()} (${claim.status})
                                            `).join('<br>')}
                                        </div>
                                    `;
                                } else {
                                    claimsHtml = '<div style="margin: 10px 0; padding: 10px; background: #d4edda; border-radius: 4px;">✅ No pending claims found</div>';
                                }
                                
                                resultDiv.innerHTML = `
                                    <div style="color: green;">
                                        ✅ <strong>COMPLETE WORKFLOW SUCCESS</strong><br><br>
                                        
                                        <div style="margin: 10px 0; padding: 10px; background: #d1ecf1; border-radius: 4px;">
                                            🔍 <strong>Policy Verification:</strong><br>
                                            📋 Policy: ${policyData.data.policyNumber}<br>
                                            👤 Customer: ${policyData.data.customerName}<br>
                                            💰 Coverage: ₹${policyData.data.coverageAmount?.toLocaleString()}<br>
                                            ✨ Status: ${policyData.data.status}
                                        </div>
                                        
                                        ${claimsHtml}
                                        
                                        <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                                            🎯 <strong>Result:</strong> Both policy verification and claims display are working correctly!
                                        </div>
                                    </div>
                                `;
                            });
                    } else {
                        resultDiv.innerHTML = `<div style="color: red;">❌ Policy verification failed: ${policyData.message}</div>`;
                    }
                })
                .catch(error => {
                    resultDiv.innerHTML = `<div style="color: red;">❌ Workflow failed: ${error.message}</div>`;
                });
        }
        
        // Auto-run basic tests on page load
        window.addEventListener('load', function() {
            setTimeout(() => {
                testPolicy('HLT/2025/5324');
                setTimeout(() => testClaims(), 1000);
            }, 500);
        });
    </script>
</body>
</html>
